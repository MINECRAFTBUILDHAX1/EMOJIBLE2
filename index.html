<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emojible</title>
    <style>
        /* Existing styles remain unchanged */
    </style>
</head>
<body>
    <!-- Help Icon -->
    <div class="help-icon" onclick="showHelp()">&#63;</div>

    <div id="game-container">
        <h1>Welcome to Emojible!</h1>
        <div id="emoji-puzzle">
            <!-- Emoji puzzle will go here -->
        </div>
        <input type="text" id="answer-input" placeholder="Type your answer..." />
        <button id="submit-btn">Submit</button>
        <p id="message"></p>
        <div id="progress-bar-container">
            <div id="progress-bar"></div>
        </div>
        <p id="next-puzzle-message"></p> <!-- Come back tomorrow message -->
    </div>

    <!-- Help Popup -->
    <div id="help-popup" class="help-popup">
        <div class="popup-content">
            <h2>Help</h2>
            <p>The progress bar shows if your answer is correct:</p>
            <ul>
                <li>Fully green and "Correct!" means your answer is almost there, but it may have too many letters.</li>
            </ul>
            <button onclick="closeHelp()">Close</button>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <ul>
            <li><a href="privacy.html" target="_blank">Privacy Notice</a></li>
            <li><a href="terms.html" target="_blank">Terms of Service</a></li>
            <li><a href="mailto:mmajcherczykolczak@gmail.com?subject=Enquiry%20about%20Emojible">Contact</a></li>
        </ul>
    </footer>

    <script>
        // Sample puzzles
        const puzzles = [
            { emoji: 'ü¶Åüëë', answer: 'The Lion King' }, // Today's puzzle
            { emoji: 'üçîüçü', answer: 'Fast Food' }     // Next day's puzzle (upcoming)
        ];

        let currentPuzzle = 0;

        function calculateProgress(userAnswer, correctAnswer) {
            const userAnswerLower = userAnswer.toLowerCase();
            const correctAnswerLower = correctAnswer.toLowerCase();
            let similarity = 0;

            for (let i = 0; i < Math.min(userAnswerLower.length, correctAnswerLower.length); i++) {
                if (userAnswerLower[i] === correctAnswerLower[i]) {
                    similarity++;
                }
            }
            return (similarity / correctAnswerLower.length) * 100;
        }

        function updateProgressBar(progress, message) {
            const progressBar = document.getElementById('progress-bar');
            progressBar.style.width = `${progress}%`;

            if (progress === 100) {
                progressBar.style.backgroundColor = 'green';
                document.getElementById('message').textContent = 'Correct! üéâ';
            } else if (progress >= 50) {
                progressBar.style.backgroundColor = 'orange';
                document.getElementById('message').textContent = message || 'Almost there!';
            } else {
                progressBar.style.backgroundColor = 'red';
                document.getElementById('message').textContent = 'Try again! ‚ùå';
            }
        }

        function submitAnswer() {
            const userAnswer = document.getElementById('answer-input').value.trim();
            const correctAnswer = puzzles[currentPuzzle].answer;

            if (!userAnswer) {
                updateProgressBar(0, 'Try again! ‚ùå');
                return;
            }

            const progress = calculateProgress(userAnswer, correctAnswer);
            updateProgressBar(progress);

            if (userAnswer.toLowerCase() === correctAnswer.toLowerCase()) {
                localStorage.setItem('puzzleCompleted', 'true');
                localStorage.setItem('puzzleCompletedTime', Date.now()); // Save completion time
                disablePuzzle(24 * 60 * 60 * 1000); // Start 24-hour timer
            }
        }

        document.getElementById('submit-btn').addEventListener('click', submitAnswer);
        document.getElementById('answer-input').addEventListener('keypress', function (event) {
            if (event.key === 'Enter') {
                submitAnswer();
            }
        });

        function checkIfPuzzleCompleted() {
            const completedTime = localStorage.getItem('puzzleCompletedTime');

            if (completedTime) {
                const timePassed = Date.now() - parseInt(completedTime, 10);
                const remainingTime = 24 * 60 * 60 * 1000 - timePassed;

                if (remainingTime > 0) {
                    disablePuzzle(remainingTime);
                    return;
                } else {
                    localStorage.removeItem('puzzleCompleted');
                    localStorage.removeItem('puzzleCompletedTime');
                }
            }
            loadPuzzle(); // Show puzzle if it's a new day
        }

        function disablePuzzle(remainingTime) {
            document.getElementById('answer-input').disabled = true;
            document.getElementById('submit-btn').disabled = true;
            document.getElementById('next-puzzle-message').textContent = 'You have completed today\'s puzzle! ‚úÖ Next puzzle in: ';

            const countdownElement = document.createElement('span');
            document.getElementById('next-puzzle-message').appendChild(countdownElement);

            function updateTimer() {
                const hours = Math.floor(remainingTime / (1000 * 60 * 60));
                const minutes = Math.floor((remainingTime % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((remainingTime % (1000 * 60)) / 1000);
                countdownElement.textContent = `${hours}h ${minutes}m ${seconds}s`;

                if (remainingTime > 0) {
                    remainingTime -= 1000;
                    setTimeout(updateTimer, 1000);
                } else {
                    localStorage.removeItem('puzzleCompleted');
                    localStorage.removeItem('puzzleCompletedTime');
                    location.reload();
                }
            }
            updateTimer();

            // Show puzzle but disable input
            document.getElementById('emoji-puzzle').textContent = puzzles[currentPuzzle].emoji;
        }

        function loadPuzzle() {
            console.log(puzzles); // Check the contents of the puzzles array
            document.getElementById('emoji-puzzle').textContent = puzzles[currentPuzzle].emoji;
        }

        window.onload = function () {
            checkIfPuzzleCompleted();
        };
    </script>
</body>
</html>
